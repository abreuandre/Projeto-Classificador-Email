@echo off
echo ======================================================================
echo 🚀 SISTEMA DE CLASSIFICAÇÃO DE EMAILS - CONFIGURAÇÃO AUTOMÁTICA
echo ======================================================================

echo.
echo 📁 Verificando diretório atual...
cd /d "%~dp0"
echo Diretório: %CD%

echo.
echo 🐍 Verificando Python...
python --version
if %errorlevel% neq 0 (
    echo ❌ Python não encontrado! Instale Python 3.9+ primeiro.
    echo 📥 Download: https://www.python.org/downloads/
    pause
    exit /b 1
)

echo.
echo 📦 Criando ambiente virtual...
if exist venv (
    echo ⚠️ Ambiente virtual já existe, removendo...
    rmdir /s /q venv
)

python -m venv venv
if %errorlevel% neq 0 (
    echo ❌ Erro ao criar ambiente virtual
    pause
    exit /b 1
)

echo.
echo 🔧 Ativando ambiente virtual...
call venv\Scripts\activate.bat

echo.
echo 📚 Instalando dependências Python...
pip install --upgrade pip
pip install -r requirements.txt
if %errorlevel% neq 0 (
    echo ❌ Erro ao instalar dependências
    pause
    exit /b 1
)

echo.
echo 🧠 Configurando recursos NLTK...
python setup_nltk.py
if %errorlevel% neq 0 (
    echo ⚠️ Problemas na configuração NLTK, mas continuando...
)

echo.
echo 🧪 Testando servidor...
echo Iniciando servidor de teste por 10 segundos...
start /b python app.py
timeout /t 10 /nobreak > nul

echo.
echo 💻 Verificando Node.js...
node --version
if %errorlevel% neq 0 (
    echo ❌ Node.js não encontrado! Instale Node.js 16+ primeiro.
    echo 📥 Download: https://nodejs.org/
    pause
    exit /b 1
)

echo.
echo 📦 Instalando dependências frontend...
npm install
if %errorlevel% neq 0 (
    echo ❌ Erro ao instalar dependências Node.js
    pause
    exit /b 1
)

echo.
echo ======================================================================
echo 🎉 CONFIGURAÇÃO CONCLUÍDA COM SUCESSO!
echo ======================================================================
echo.
echo 🚀 Para executar a aplicação:
echo.
echo Terminal 1 (Backend):
echo   venv\Scripts\activate
echo   python app.py
echo   📍 http://localhost:5000
echo.
echo Terminal 2 (Frontend):
echo   npm run dev  
echo   📍 http://localhost:3000
echo.
echo 🧪 Para testar:
echo   python test_api.py
echo.
echo ======================================================================

pause