@echo off
echo ======================================================================
echo ğŸš€ SISTEMA DE CLASSIFICAÃ‡ÃƒO DE EMAILS - CONFIGURAÃ‡ÃƒO AUTOMÃTICA
echo ======================================================================

echo.
echo ğŸ“ Verificando diretÃ³rio atual...
cd /d "%~dp0"
echo DiretÃ³rio: %CD%

echo.
echo ğŸ Verificando Python...
python --version
if %errorlevel% neq 0 (
    echo âŒ Python nÃ£o encontrado! Instale Python 3.9+ primeiro.
    echo ğŸ“¥ Download: https://www.python.org/downloads/
    pause
    exit /b 1
)

echo.
echo ğŸ“¦ Criando ambiente virtual...
if exist venv (
    echo âš ï¸ Ambiente virtual jÃ¡ existe, removendo...
    rmdir /s /q venv
)

python -m venv venv
if %errorlevel% neq 0 (
    echo âŒ Erro ao criar ambiente virtual
    pause
    exit /b 1
)

echo.
echo ğŸ”§ Ativando ambiente virtual...
call venv\Scripts\activate.bat

echo.
echo ğŸ“š Instalando dependÃªncias Python...
pip install --upgrade pip
pip install -r requirements.txt
if %errorlevel% neq 0 (
    echo âŒ Erro ao instalar dependÃªncias
    pause
    exit /b 1
)

echo.
echo ğŸ§  Configurando recursos NLTK...
python setup_nltk.py
if %errorlevel% neq 0 (
    echo âš ï¸ Problemas na configuraÃ§Ã£o NLTK, mas continuando...
)

echo.
echo ğŸ§ª Testando servidor...
echo Iniciando servidor de teste por 10 segundos...
start /b python app.py
timeout /t 10 /nobreak > nul

echo.
echo ğŸ’» Verificando Node.js...
node --version
if %errorlevel% neq 0 (
    echo âŒ Node.js nÃ£o encontrado! Instale Node.js 16+ primeiro.
    echo ğŸ“¥ Download: https://nodejs.org/
    pause
    exit /b 1
)

echo.
echo ğŸ“¦ Instalando dependÃªncias frontend...
npm install
if %errorlevel% neq 0 (
    echo âŒ Erro ao instalar dependÃªncias Node.js
    pause
    exit /b 1
)

echo.
echo ======================================================================
echo ğŸ‰ CONFIGURAÃ‡ÃƒO CONCLUÃDA COM SUCESSO!
echo ======================================================================
echo.
echo ğŸš€ Para executar a aplicaÃ§Ã£o:
echo.
echo Terminal 1 (Backend):
echo   venv\Scripts\activate
echo   python app.py
echo   ğŸ“ http://localhost:5000
echo.
echo Terminal 2 (Frontend):
echo   npm run dev  
echo   ğŸ“ http://localhost:3000
echo.
echo ğŸ§ª Para testar:
echo   python test_api.py
echo.
echo ======================================================================

pause